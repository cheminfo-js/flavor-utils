{"version":3,"sources":["flavor-utils.min.js"],"names":["e","exports","module","define","amd","f","window","global","self","flavorUtils","t","n","r","s","o","u","a","require","i","Error","code","l","call","length",1,"deleteDoc","opts","doc","Promise","resolve","reject","url","databaseUrl","_id","console","log","superagent","del","query","rev","_rev","end","err","res","updateDoc","put","set","send","body","saveDoc","post","getJSON","get","getView","view","key","x","split","designDoc","viewName","encodeURIComponent","JSON","stringify","processCommonParams","params","couchUrl","replace","couchDatabase","Base64","FlavorUtils","cloneFlavor","source","target","flavor","username","then","doEl","data","meta","newDoc","prom","push","result","id","value","undefined","all","arr","flavors","name","_attachments","content_type","encode","rows","done","deleteFlavor","keys","Object","stack","./Base64",2,"noop","isHost","obj","str","toString","isObject","serialize","pairs","join","parseString","parts","pair","len","decodeURIComponent","parseHeader","index","line","field","val","lines","fields","pop","indexOf","slice","toLowerCase","trim","type","shift","reduce","Response","req","options","this","xhr","text","method","responseType","responseText","statusText","setStatusProperties","status","header","headers","getAllResponseHeaders","getResponseHeader","setHeaderProperties","parseBody","response","Request","Emitter","_query","_header","on","parse","original","callback","emit","new_err","request","arguments","root","getXHR","XMLHttpRequest","location","protocol","ActiveXObject","serializeObject","types","html","json","xml","urlencoded","form","form-data","application/x-www-form-urlencoded","application/json","prototype","ct","statusType","info","ok","clientError","serverError","error","toError","accepted","noContent","badRequest","unauthorized","notAcceptable","notFound","forbidden","msg","use","fn","timeout","ms","_timeout","clearTimeout","_timer","abort","aborted","unset","getHeader","accept","auth","user","pass","btoa","_formData","FormData","append","attach","file","filename","_data","_callback","crossDomainError","crossDomain","timeoutError","withCredentials","_withCredentials","onreadystatechange","readyState","timedout","handleProgress","total","percent","loaded","hasListeners","onprogress","upload","setTimeout","open","setRequestHeader","head","patch","emitter",3,"mixin","addEventListener","event","_callbacks","once","off","apply","removeListener","removeAllListeners","removeEventListener","callbacks","cb","splice","args","listeners",4,"initial","idx","curr",5,"_keyStr","input","chr1","chr2","chr3","enc1","enc2","enc3","enc4","output","_utf8_encode","charCodeAt","isNaN","charAt","decode","String","fromCharCode","_utf8_decode","string","utftext","c","c1","c2","c3"],"mappings":"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","file":"flavor-utils.min.js","sourcesContent":["/**\n * flavor-utils - Utility functions to manipulate cheminfo flavor system on couchdb\n * @version v1.0.0\n * @link https://github.com/cheminfo-js/flavor-utils\n * @license MIT\n */\n!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var f;\"undefined\"!=typeof window?f=window:\"undefined\"!=typeof global?f=global:\"undefined\"!=typeof self&&(f=self),f.flavorUtils=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar superagent= require('superagent');\nvar Base64 = require('./Base64');\nmodule.exports = {};\n\nvar FlavorUtils = module.exports = {};\n\n/**\n * Clone a flavor from one user to another\n * @param {Object} opts - clone options\n * @param {Object} opts.source - source description\n * @param {string} opts.source.username - The name of the user's from which to clone\n * @param {string} opts.source.flavor - The name of the flavor to clone\n * @param {string} opts.source.couchUrl - Couchdb root url of the source. It should contain username + password if necessary\n * @param {string} opts.target.couchDatabase - the name of the target couchdb database\n * @param {string} opts.target - target description\n * @param {String} opts.target.username - The target username to which to clone the flavor\n * @param {string} opts.target.flavor - The name of the flavor in the target\n * @param {string} opts.target.couchUrl - Couchdb root url of the target. It should contain username + password if necessary\n * @param {string} opts.target.couchDatabase - the name of the target couchdb database\n */\nFlavorUtils.cloneFlavor = function(opts) {\n    processCommonParams(opts.source);\n    processCommonParams(opts.target);\n    var key = [opts.source.flavor, opts.source.username];\n    getView(opts.source, 'flavor/docs', key).then(function(res) {\n        var result = res.rows;\n        if(!result) return;\n        var done = Promise.resolve();\n        var i= 0;\n        for(i=0; i<result.length; i++) {\n            done = done.then(doEl(i));\n        }\n        done.then(function() {\n            console.log('all done');\n        }, function(err) {\n            console.log('error:', err);\n        });\n\n\n        function doEl(i) {\n            return function () {\n                var prom = [];\n                var view, data, meta, doc, newDoc;\n                prom.push(getJSON(opts.source.databaseUrl + '/' + result[i].id));\n                if (result[i].value.view) {\n                    view = getJSON(opts.source.databaseUrl + '/' + result[i].id + '/view.json');\n                    prom.push(view);\n                }\n                else prom.push(undefined);\n                if (result[i].value.data) {\n                    data = getJSON(opts.source.databaseUrl + '/' + result[i].id + '/data.json');\n                    prom.push(data);\n                }\n                else prom.push(undefined);\n                if (result[i].value.meta) {\n                    meta = getJSON(opts.source.databaseUrl + '/' + result[i].id + '/meta.json');\n                    prom.push(meta);\n                }\n                else prom.push(undefined);\n                var prom = Promise.all(prom);\n                prom = prom.then(function (arr) {\n                    doc = arr[0];\n                    newDoc = {};\n                    var view = arr[1];\n                    var data = arr[2];\n                    var meta = arr[3];\n                    delete doc._rev;\n\n                    newDoc.flavors = {};\n                    if(doc.flavors[opts.source.flavor]) {\n                        newDoc.flavors[opts.target.flavor] = doc.flavors[opts.source.flavor];\n                    }\n\n                    newDoc.name = opts.target.username;\n\n                    if(meta) {\n                        newDoc._attachments = newDoc._attachments || {};\n                        newDoc._attachments['meta.json'] = {\n                            'content_type': 'application/json',\n                            'data': Base64.encode(JSON.stringify(meta))\n                        };\n                    }\n                    if(view) {\n                        newDoc._attachments = newDoc._attachments || {};\n                        newDoc._attachments['view.json'] = {\n                            'content_type': 'application/json',\n                            'data': Base64.encode(JSON.stringify(view))\n                        };\n                    }\n                    if(data) {\n                        newDoc._attachments = newDoc._attachments || {};\n                        newDoc._attachments['data.json'] = {\n                            'content_type': 'application/json',\n                            'data': Base64.encode(JSON.stringify(data))\n                        };\n                    }\n                });\n                return prom.then(function() {\n                    saveDoc(opts.target, newDoc);\n                });\n            }\n        }\n    });\n};\n\nFlavorUtils.deleteFlavor = function(opts) {\n    processCommonParams(opts);\n    var key = [opts.flavor, opts.username];\n    return getView(opts, 'flavor/docs', key).then(function(res) {\n        var result = res.rows;\n        var done = Promise.resolve();\n        for(var i=0; i<result.length; i++) {\n            done.then(doEl(i));\n        }\n\n        done.then(function() {\n            console.log('delete flavor done');\n        }, function(err) {\n            console.log('Error!', err, err.stack);\n        });\n\n        function doEl(i) {\n            var prom = getJSON(opts.databaseUrl + '/' + result[i].id);\n            prom = prom.then(function(doc) {\n                delete doc.flavors[opts.flavor];\n                var keys = Object.keys(doc.flavors);\n                if(keys.length === 0) {\n                    return deleteDoc(opts, doc);\n                }\n                else {\n                    return updateDoc(opts, doc);\n                }\n            });\n            return prom;\n        }\n        return done;\n    });\n};\n\n\nfunction deleteDoc(opts, doc) {\n    return new Promise(function(resolve, reject) {\n        var url = opts.databaseUrl + '/' + doc._id;\n        console.log(url);\n        superagent\n            .del(url)\n            .query({rev: doc._rev})\n            .end(function(err, res) {\n                if(err) {\n                    console.log(err);\n                    return reject(err);\n                }\n                console.log(res)\n                resolve(res);\n            })\n    });\n}\n\nfunction updateDoc(opts, doc) {\n    return new Promise(function(resolve, reject) {\n        console.log('update doc');\n        var url = opts.databaseUrl + '/' + doc._id;\n        superagent\n            .put(url)\n            .set('Content-Type', 'application/json')\n            .send(doc)\n            .end(function(err, res) {\n                if(err) {\n                    return reject(err);\n                }\n                resolve(res.body);\n            })\n    });\n}\n\nfunction saveDoc(opts, doc) {\n    return new Promise(function(resolve, reject) {\n        var url = opts.databaseUrl;\n        delete doc._id;\n        superagent\n            .post(url)\n            .set('Content-Type', 'application/json')\n            .send(doc)\n            .end(function(err, res) {\n                if(err) {\n                    return reject(err);\n                }\n                resolve(res.body);\n            })\n    });\n}\n/**\n * Get couchdb uuids\n * @param {Object} count - the number of uuids needed\n *\n */\nfunction getUUIDs(opts, count) {\n    count = count || 1;\n    return getJSON(opts.couchUrl + '/_uuids?count=' + count);\n}\n\nfunction getJSON(url) {\n    return new Promise(function(resolve, reject) {\n        superagent\n            .get(url)\n            .set('Accept', 'application/json')\n            .end(function(err, res) {\n                if(err) {\n                    return reject(err);\n                }\n                resolve(res.body);\n            })\n    });\n}\n\nfunction getView(opts, view, key) {\n    var x = view.split('/');\n    var designDoc = '_design/' + x[0];\n    var viewName = x[1];\n\n    return getJSON(opts.databaseUrl + '/' + designDoc + '/_view/' + viewName + '?key=' + encodeURIComponent(JSON.stringify(key)));\n}\n\nfunction processCommonParams(params) {\n    if(!params) return;\n    if(params.couchUrl) params.couchUrl = params.couchUrl.replace(/\\/$/, '');\n    if(params.couchUrl && params.couchDatabase) {\n        params.databaseUrl =params.couchUrl + '/' + params.couchDatabase;\n    }\n\n}\n\n\n},{\"./Base64\":5,\"superagent\":2}],2:[function(require,module,exports){\n/**\n * Module dependencies.\n */\n\nvar Emitter = require('emitter');\nvar reduce = require('reduce');\n\n/**\n * Root reference for iframes.\n */\n\nvar root = 'undefined' == typeof window\n  ? (this || self)\n  : window;\n\n/**\n * Noop.\n */\n\nfunction noop(){};\n\n/**\n * Check if `obj` is a host object,\n * we don't want to serialize these :)\n *\n * TODO: future proof, move to compoent land\n *\n * @param {Object} obj\n * @return {Boolean}\n * @api private\n */\n\nfunction isHost(obj) {\n  var str = {}.toString.call(obj);\n\n  switch (str) {\n    case '[object File]':\n    case '[object Blob]':\n    case '[object FormData]':\n      return true;\n    default:\n      return false;\n  }\n}\n\n/**\n * Determine XHR.\n */\n\nrequest.getXHR = function () {\n  if (root.XMLHttpRequest\n      && (!root.location || 'file:' != root.location.protocol\n          || !root.ActiveXObject)) {\n    return new XMLHttpRequest;\n  } else {\n    try { return new ActiveXObject('Microsoft.XMLHTTP'); } catch(e) {}\n    try { return new ActiveXObject('Msxml2.XMLHTTP.6.0'); } catch(e) {}\n    try { return new ActiveXObject('Msxml2.XMLHTTP.3.0'); } catch(e) {}\n    try { return new ActiveXObject('Msxml2.XMLHTTP'); } catch(e) {}\n  }\n  return false;\n};\n\n/**\n * Removes leading and trailing whitespace, added to support IE.\n *\n * @param {String} s\n * @return {String}\n * @api private\n */\n\nvar trim = ''.trim\n  ? function(s) { return s.trim(); }\n  : function(s) { return s.replace(/(^\\s*|\\s*$)/g, ''); };\n\n/**\n * Check if `obj` is an object.\n *\n * @param {Object} obj\n * @return {Boolean}\n * @api private\n */\n\nfunction isObject(obj) {\n  return obj === Object(obj);\n}\n\n/**\n * Serialize the given `obj`.\n *\n * @param {Object} obj\n * @return {String}\n * @api private\n */\n\nfunction serialize(obj) {\n  if (!isObject(obj)) return obj;\n  var pairs = [];\n  for (var key in obj) {\n    if (null != obj[key]) {\n      pairs.push(encodeURIComponent(key)\n        + '=' + encodeURIComponent(obj[key]));\n    }\n  }\n  return pairs.join('&');\n}\n\n/**\n * Expose serialization method.\n */\n\n request.serializeObject = serialize;\n\n /**\n  * Parse the given x-www-form-urlencoded `str`.\n  *\n  * @param {String} str\n  * @return {Object}\n  * @api private\n  */\n\nfunction parseString(str) {\n  var obj = {};\n  var pairs = str.split('&');\n  var parts;\n  var pair;\n\n  for (var i = 0, len = pairs.length; i < len; ++i) {\n    pair = pairs[i];\n    parts = pair.split('=');\n    obj[decodeURIComponent(parts[0])] = decodeURIComponent(parts[1]);\n  }\n\n  return obj;\n}\n\n/**\n * Expose parser.\n */\n\nrequest.parseString = parseString;\n\n/**\n * Default MIME type map.\n *\n *     superagent.types.xml = 'application/xml';\n *\n */\n\nrequest.types = {\n  html: 'text/html',\n  json: 'application/json',\n  xml: 'application/xml',\n  urlencoded: 'application/x-www-form-urlencoded',\n  'form': 'application/x-www-form-urlencoded',\n  'form-data': 'application/x-www-form-urlencoded'\n};\n\n/**\n * Default serialization map.\n *\n *     superagent.serialize['application/xml'] = function(obj){\n *       return 'generated xml here';\n *     };\n *\n */\n\n request.serialize = {\n   'application/x-www-form-urlencoded': serialize,\n   'application/json': JSON.stringify\n };\n\n /**\n  * Default parsers.\n  *\n  *     superagent.parse['application/xml'] = function(str){\n  *       return { object parsed from str };\n  *     };\n  *\n  */\n\nrequest.parse = {\n  'application/x-www-form-urlencoded': parseString,\n  'application/json': JSON.parse\n};\n\n/**\n * Parse the given header `str` into\n * an object containing the mapped fields.\n *\n * @param {String} str\n * @return {Object}\n * @api private\n */\n\nfunction parseHeader(str) {\n  var lines = str.split(/\\r?\\n/);\n  var fields = {};\n  var index;\n  var line;\n  var field;\n  var val;\n\n  lines.pop(); // trailing CRLF\n\n  for (var i = 0, len = lines.length; i < len; ++i) {\n    line = lines[i];\n    index = line.indexOf(':');\n    field = line.slice(0, index).toLowerCase();\n    val = trim(line.slice(index + 1));\n    fields[field] = val;\n  }\n\n  return fields;\n}\n\n/**\n * Return the mime type for the given `str`.\n *\n * @param {String} str\n * @return {String}\n * @api private\n */\n\nfunction type(str){\n  return str.split(/ *; */).shift();\n};\n\n/**\n * Return header field parameters.\n *\n * @param {String} str\n * @return {Object}\n * @api private\n */\n\nfunction params(str){\n  return reduce(str.split(/ *; */), function(obj, str){\n    var parts = str.split(/ *= */)\n      , key = parts.shift()\n      , val = parts.shift();\n\n    if (key && val) obj[key] = val;\n    return obj;\n  }, {});\n};\n\n/**\n * Initialize a new `Response` with the given `xhr`.\n *\n *  - set flags (.ok, .error, etc)\n *  - parse header\n *\n * Examples:\n *\n *  Aliasing `superagent` as `request` is nice:\n *\n *      request = superagent;\n *\n *  We can use the promise-like API, or pass callbacks:\n *\n *      request.get('/').end(function(res){});\n *      request.get('/', function(res){});\n *\n *  Sending data can be chained:\n *\n *      request\n *        .post('/user')\n *        .send({ name: 'tj' })\n *        .end(function(res){});\n *\n *  Or passed to `.send()`:\n *\n *      request\n *        .post('/user')\n *        .send({ name: 'tj' }, function(res){});\n *\n *  Or passed to `.post()`:\n *\n *      request\n *        .post('/user', { name: 'tj' })\n *        .end(function(res){});\n *\n * Or further reduced to a single call for simple cases:\n *\n *      request\n *        .post('/user', { name: 'tj' }, function(res){});\n *\n * @param {XMLHTTPRequest} xhr\n * @param {Object} options\n * @api private\n */\n\nfunction Response(req, options) {\n  options = options || {};\n  this.req = req;\n  this.xhr = this.req.xhr;\n  // responseText is accessible only if responseType is '' or 'text' and on older browsers\n  this.text = ((this.req.method !='HEAD' && (this.xhr.responseType === '' || this.xhr.responseType === 'text')) || typeof this.xhr.responseType === 'undefined')\n     ? this.xhr.responseText\n     : null;\n  this.statusText = this.req.xhr.statusText;\n  this.setStatusProperties(this.xhr.status);\n  this.header = this.headers = parseHeader(this.xhr.getAllResponseHeaders());\n  // getAllResponseHeaders sometimes falsely returns \"\" for CORS requests, but\n  // getResponseHeader still works. so we get content-type even if getting\n  // other headers fails.\n  this.header['content-type'] = this.xhr.getResponseHeader('content-type');\n  this.setHeaderProperties(this.header);\n  this.body = this.req.method != 'HEAD'\n    ? this.parseBody(this.text ? this.text : this.xhr.response)\n    : null;\n}\n\n/**\n * Get case-insensitive `field` value.\n *\n * @param {String} field\n * @return {String}\n * @api public\n */\n\nResponse.prototype.get = function(field){\n  return this.header[field.toLowerCase()];\n};\n\n/**\n * Set header related properties:\n *\n *   - `.type` the content type without params\n *\n * A response of \"Content-Type: text/plain; charset=utf-8\"\n * will provide you with a `.type` of \"text/plain\".\n *\n * @param {Object} header\n * @api private\n */\n\nResponse.prototype.setHeaderProperties = function(header){\n  // content-type\n  var ct = this.header['content-type'] || '';\n  this.type = type(ct);\n\n  // params\n  var obj = params(ct);\n  for (var key in obj) this[key] = obj[key];\n};\n\n/**\n * Parse the given body `str`.\n *\n * Used for auto-parsing of bodies. Parsers\n * are defined on the `superagent.parse` object.\n *\n * @param {String} str\n * @return {Mixed}\n * @api private\n */\n\nResponse.prototype.parseBody = function(str){\n  var parse = request.parse[this.type];\n  return parse && str && (str.length || str instanceof Object)\n    ? parse(str)\n    : null;\n};\n\n/**\n * Set flags such as `.ok` based on `status`.\n *\n * For example a 2xx response will give you a `.ok` of __true__\n * whereas 5xx will be __false__ and `.error` will be __true__. The\n * `.clientError` and `.serverError` are also available to be more\n * specific, and `.statusType` is the class of error ranging from 1..5\n * sometimes useful for mapping respond colors etc.\n *\n * \"sugar\" properties are also defined for common cases. Currently providing:\n *\n *   - .noContent\n *   - .badRequest\n *   - .unauthorized\n *   - .notAcceptable\n *   - .notFound\n *\n * @param {Number} status\n * @api private\n */\n\nResponse.prototype.setStatusProperties = function(status){\n  // handle IE9 bug: http://stackoverflow.com/questions/10046972/msie-returns-status-code-of-1223-for-ajax-request\n  if (status === 1223) {\n    status = 204;\n  }\n\n  var type = status / 100 | 0;\n\n  // status / class\n  this.status = status;\n  this.statusType = type;\n\n  // basics\n  this.info = 1 == type;\n  this.ok = 2 == type;\n  this.clientError = 4 == type;\n  this.serverError = 5 == type;\n  this.error = (4 == type || 5 == type)\n    ? this.toError()\n    : false;\n\n  // sugar\n  this.accepted = 202 == status;\n  this.noContent = 204 == status;\n  this.badRequest = 400 == status;\n  this.unauthorized = 401 == status;\n  this.notAcceptable = 406 == status;\n  this.notFound = 404 == status;\n  this.forbidden = 403 == status;\n};\n\n/**\n * Return an `Error` representative of this response.\n *\n * @return {Error}\n * @api public\n */\n\nResponse.prototype.toError = function(){\n  var req = this.req;\n  var method = req.method;\n  var url = req.url;\n\n  var msg = 'cannot ' + method + ' ' + url + ' (' + this.status + ')';\n  var err = new Error(msg);\n  err.status = this.status;\n  err.method = method;\n  err.url = url;\n\n  return err;\n};\n\n/**\n * Expose `Response`.\n */\n\nrequest.Response = Response;\n\n/**\n * Initialize a new `Request` with the given `method` and `url`.\n *\n * @param {String} method\n * @param {String} url\n * @api public\n */\n\nfunction Request(method, url) {\n  var self = this;\n  Emitter.call(this);\n  this._query = this._query || [];\n  this.method = method;\n  this.url = url;\n  this.header = {};\n  this._header = {};\n  this.on('end', function(){\n    var err = null;\n    var res = null;\n\n    try {\n      res = new Response(self);\n    } catch(e) {\n      err = new Error('Parser is unable to parse the response');\n      err.parse = true;\n      err.original = e;\n      return self.callback(err);\n    }\n\n    self.emit('response', res);\n\n    if (err) {\n      return self.callback(err, res);\n    }\n\n    if (res.status >= 200 && res.status < 300) {\n      return self.callback(err, res);\n    }\n\n    var new_err = new Error(res.statusText || 'Unsuccessful HTTP response');\n    new_err.original = err;\n    new_err.response = res;\n    new_err.status = res.status;\n\n    self.callback(err || new_err, res);\n  });\n}\n\n/**\n * Mixin `Emitter`.\n */\n\nEmitter(Request.prototype);\n\n/**\n * Allow for extension\n */\n\nRequest.prototype.use = function(fn) {\n  fn(this);\n  return this;\n}\n\n/**\n * Set timeout to `ms`.\n *\n * @param {Number} ms\n * @return {Request} for chaining\n * @api public\n */\n\nRequest.prototype.timeout = function(ms){\n  this._timeout = ms;\n  return this;\n};\n\n/**\n * Clear previous timeout.\n *\n * @return {Request} for chaining\n * @api public\n */\n\nRequest.prototype.clearTimeout = function(){\n  this._timeout = 0;\n  clearTimeout(this._timer);\n  return this;\n};\n\n/**\n * Abort the request, and clear potential timeout.\n *\n * @return {Request}\n * @api public\n */\n\nRequest.prototype.abort = function(){\n  if (this.aborted) return;\n  this.aborted = true;\n  this.xhr.abort();\n  this.clearTimeout();\n  this.emit('abort');\n  return this;\n};\n\n/**\n * Set header `field` to `val`, or multiple fields with one object.\n *\n * Examples:\n *\n *      req.get('/')\n *        .set('Accept', 'application/json')\n *        .set('X-API-Key', 'foobar')\n *        .end(callback);\n *\n *      req.get('/')\n *        .set({ Accept: 'application/json', 'X-API-Key': 'foobar' })\n *        .end(callback);\n *\n * @param {String|Object} field\n * @param {String} val\n * @return {Request} for chaining\n * @api public\n */\n\nRequest.prototype.set = function(field, val){\n  if (isObject(field)) {\n    for (var key in field) {\n      this.set(key, field[key]);\n    }\n    return this;\n  }\n  this._header[field.toLowerCase()] = val;\n  this.header[field] = val;\n  return this;\n};\n\n/**\n * Remove header `field`.\n *\n * Example:\n *\n *      req.get('/')\n *        .unset('User-Agent')\n *        .end(callback);\n *\n * @param {String} field\n * @return {Request} for chaining\n * @api public\n */\n\nRequest.prototype.unset = function(field){\n  delete this._header[field.toLowerCase()];\n  delete this.header[field];\n  return this;\n};\n\n/**\n * Get case-insensitive header `field` value.\n *\n * @param {String} field\n * @return {String}\n * @api private\n */\n\nRequest.prototype.getHeader = function(field){\n  return this._header[field.toLowerCase()];\n};\n\n/**\n * Set Content-Type to `type`, mapping values from `request.types`.\n *\n * Examples:\n *\n *      superagent.types.xml = 'application/xml';\n *\n *      request.post('/')\n *        .type('xml')\n *        .send(xmlstring)\n *        .end(callback);\n *\n *      request.post('/')\n *        .type('application/xml')\n *        .send(xmlstring)\n *        .end(callback);\n *\n * @param {String} type\n * @return {Request} for chaining\n * @api public\n */\n\nRequest.prototype.type = function(type){\n  this.set('Content-Type', request.types[type] || type);\n  return this;\n};\n\n/**\n * Set Accept to `type`, mapping values from `request.types`.\n *\n * Examples:\n *\n *      superagent.types.json = 'application/json';\n *\n *      request.get('/agent')\n *        .accept('json')\n *        .end(callback);\n *\n *      request.get('/agent')\n *        .accept('application/json')\n *        .end(callback);\n *\n * @param {String} accept\n * @return {Request} for chaining\n * @api public\n */\n\nRequest.prototype.accept = function(type){\n  this.set('Accept', request.types[type] || type);\n  return this;\n};\n\n/**\n * Set Authorization field value with `user` and `pass`.\n *\n * @param {String} user\n * @param {String} pass\n * @return {Request} for chaining\n * @api public\n */\n\nRequest.prototype.auth = function(user, pass){\n  var str = btoa(user + ':' + pass);\n  this.set('Authorization', 'Basic ' + str);\n  return this;\n};\n\n/**\n* Add query-string `val`.\n*\n* Examples:\n*\n*   request.get('/shoes')\n*     .query('size=10')\n*     .query({ color: 'blue' })\n*\n* @param {Object|String} val\n* @return {Request} for chaining\n* @api public\n*/\n\nRequest.prototype.query = function(val){\n  if ('string' != typeof val) val = serialize(val);\n  if (val) this._query.push(val);\n  return this;\n};\n\n/**\n * Write the field `name` and `val` for \"multipart/form-data\"\n * request bodies.\n *\n * ``` js\n * request.post('/upload')\n *   .field('foo', 'bar')\n *   .end(callback);\n * ```\n *\n * @param {String} name\n * @param {String|Blob|File} val\n * @return {Request} for chaining\n * @api public\n */\n\nRequest.prototype.field = function(name, val){\n  if (!this._formData) this._formData = new root.FormData();\n  this._formData.append(name, val);\n  return this;\n};\n\n/**\n * Queue the given `file` as an attachment to the specified `field`,\n * with optional `filename`.\n *\n * ``` js\n * request.post('/upload')\n *   .attach(new Blob(['<a id=\"a\"><b id=\"b\">hey!</b></a>'], { type: \"text/html\"}))\n *   .end(callback);\n * ```\n *\n * @param {String} field\n * @param {Blob|File} file\n * @param {String} filename\n * @return {Request} for chaining\n * @api public\n */\n\nRequest.prototype.attach = function(field, file, filename){\n  if (!this._formData) this._formData = new root.FormData();\n  this._formData.append(field, file, filename);\n  return this;\n};\n\n/**\n * Send `data`, defaulting the `.type()` to \"json\" when\n * an object is given.\n *\n * Examples:\n *\n *       // querystring\n *       request.get('/search')\n *         .end(callback)\n *\n *       // multiple data \"writes\"\n *       request.get('/search')\n *         .send({ search: 'query' })\n *         .send({ range: '1..5' })\n *         .send({ order: 'desc' })\n *         .end(callback)\n *\n *       // manual json\n *       request.post('/user')\n *         .type('json')\n *         .send('{\"name\":\"tj\"})\n *         .end(callback)\n *\n *       // auto json\n *       request.post('/user')\n *         .send({ name: 'tj' })\n *         .end(callback)\n *\n *       // manual x-www-form-urlencoded\n *       request.post('/user')\n *         .type('form')\n *         .send('name=tj')\n *         .end(callback)\n *\n *       // auto x-www-form-urlencoded\n *       request.post('/user')\n *         .type('form')\n *         .send({ name: 'tj' })\n *         .end(callback)\n *\n *       // defaults to x-www-form-urlencoded\n  *      request.post('/user')\n  *        .send('name=tobi')\n  *        .send('species=ferret')\n  *        .end(callback)\n *\n * @param {String|Object} data\n * @return {Request} for chaining\n * @api public\n */\n\nRequest.prototype.send = function(data){\n  var obj = isObject(data);\n  var type = this.getHeader('Content-Type');\n\n  // merge\n  if (obj && isObject(this._data)) {\n    for (var key in data) {\n      this._data[key] = data[key];\n    }\n  } else if ('string' == typeof data) {\n    if (!type) this.type('form');\n    type = this.getHeader('Content-Type');\n    if ('application/x-www-form-urlencoded' == type) {\n      this._data = this._data\n        ? this._data + '&' + data\n        : data;\n    } else {\n      this._data = (this._data || '') + data;\n    }\n  } else {\n    this._data = data;\n  }\n\n  if (!obj || isHost(data)) return this;\n  if (!type) this.type('json');\n  return this;\n};\n\n/**\n * Invoke the callback with `err` and `res`\n * and handle arity check.\n *\n * @param {Error} err\n * @param {Response} res\n * @api private\n */\n\nRequest.prototype.callback = function(err, res){\n  var fn = this._callback;\n  this.clearTimeout();\n  fn(err, res);\n};\n\n/**\n * Invoke callback with x-domain error.\n *\n * @api private\n */\n\nRequest.prototype.crossDomainError = function(){\n  var err = new Error('Origin is not allowed by Access-Control-Allow-Origin');\n  err.crossDomain = true;\n  this.callback(err);\n};\n\n/**\n * Invoke callback with timeout error.\n *\n * @api private\n */\n\nRequest.prototype.timeoutError = function(){\n  var timeout = this._timeout;\n  var err = new Error('timeout of ' + timeout + 'ms exceeded');\n  err.timeout = timeout;\n  this.callback(err);\n};\n\n/**\n * Enable transmission of cookies with x-domain requests.\n *\n * Note that for this to work the origin must not be\n * using \"Access-Control-Allow-Origin\" with a wildcard,\n * and also must set \"Access-Control-Allow-Credentials\"\n * to \"true\".\n *\n * @api public\n */\n\nRequest.prototype.withCredentials = function(){\n  this._withCredentials = true;\n  return this;\n};\n\n/**\n * Initiate request, invoking callback `fn(res)`\n * with an instanceof `Response`.\n *\n * @param {Function} fn\n * @return {Request} for chaining\n * @api public\n */\n\nRequest.prototype.end = function(fn){\n  var self = this;\n  var xhr = this.xhr = request.getXHR();\n  var query = this._query.join('&');\n  var timeout = this._timeout;\n  var data = this._formData || this._data;\n\n  // store callback\n  this._callback = fn || noop;\n\n  // state change\n  xhr.onreadystatechange = function(){\n    if (4 != xhr.readyState) return;\n\n    // In IE9, reads to any property (e.g. status) off of an aborted XHR will\n    // result in the error \"Could not complete the operation due to error c00c023f\"\n    var status;\n    try { status = xhr.status } catch(e) { status = 0; }\n\n    if (0 == status) {\n      if (self.timedout) return self.timeoutError();\n      if (self.aborted) return;\n      return self.crossDomainError();\n    }\n    self.emit('end');\n  };\n\n  // progress\n  var handleProgress = function(e){\n    if (e.total > 0) {\n      e.percent = e.loaded / e.total * 100;\n    }\n    self.emit('progress', e);\n  };\n  if (this.hasListeners('progress')) {\n    xhr.onprogress = handleProgress;\n  }\n  try {\n    if (xhr.upload && this.hasListeners('progress')) {\n      xhr.upload.onprogress = handleProgress;\n    }\n  } catch(e) {\n    // Accessing xhr.upload fails in IE from a web worker, so just pretend it doesn't exist.\n    // Reported here:\n    // https://connect.microsoft.com/IE/feedback/details/837245/xmlhttprequest-upload-throws-invalid-argument-when-used-from-web-worker-context\n  }\n\n  // timeout\n  if (timeout && !this._timer) {\n    this._timer = setTimeout(function(){\n      self.timedout = true;\n      self.abort();\n    }, timeout);\n  }\n\n  // querystring\n  if (query) {\n    query = request.serializeObject(query);\n    this.url += ~this.url.indexOf('?')\n      ? '&' + query\n      : '?' + query;\n  }\n\n  // initiate request\n  xhr.open(this.method, this.url, true);\n\n  // CORS\n  if (this._withCredentials) xhr.withCredentials = true;\n\n  // body\n  if ('GET' != this.method && 'HEAD' != this.method && 'string' != typeof data && !isHost(data)) {\n    // serialize stuff\n    var serialize = request.serialize[this.getHeader('Content-Type')];\n    if (serialize) data = serialize(data);\n  }\n\n  // set header fields\n  for (var field in this.header) {\n    if (null == this.header[field]) continue;\n    xhr.setRequestHeader(field, this.header[field]);\n  }\n\n  // send stuff\n  this.emit('request', this);\n  xhr.send(data);\n  return this;\n};\n\n/**\n * Expose `Request`.\n */\n\nrequest.Request = Request;\n\n/**\n * Issue a request:\n *\n * Examples:\n *\n *    request('GET', '/users').end(callback)\n *    request('/users').end(callback)\n *    request('/users', callback)\n *\n * @param {String} method\n * @param {String|Function} url or callback\n * @return {Request}\n * @api public\n */\n\nfunction request(method, url) {\n  // callback\n  if ('function' == typeof url) {\n    return new Request('GET', method).end(url);\n  }\n\n  // url first\n  if (1 == arguments.length) {\n    return new Request('GET', method);\n  }\n\n  return new Request(method, url);\n}\n\n/**\n * GET `url` with optional callback `fn(res)`.\n *\n * @param {String} url\n * @param {Mixed|Function} data or fn\n * @param {Function} fn\n * @return {Request}\n * @api public\n */\n\nrequest.get = function(url, data, fn){\n  var req = request('GET', url);\n  if ('function' == typeof data) fn = data, data = null;\n  if (data) req.query(data);\n  if (fn) req.end(fn);\n  return req;\n};\n\n/**\n * HEAD `url` with optional callback `fn(res)`.\n *\n * @param {String} url\n * @param {Mixed|Function} data or fn\n * @param {Function} fn\n * @return {Request}\n * @api public\n */\n\nrequest.head = function(url, data, fn){\n  var req = request('HEAD', url);\n  if ('function' == typeof data) fn = data, data = null;\n  if (data) req.send(data);\n  if (fn) req.end(fn);\n  return req;\n};\n\n/**\n * DELETE `url` with optional callback `fn(res)`.\n *\n * @param {String} url\n * @param {Function} fn\n * @return {Request}\n * @api public\n */\n\nrequest.del = function(url, fn){\n  var req = request('DELETE', url);\n  if (fn) req.end(fn);\n  return req;\n};\n\n/**\n * PATCH `url` with optional `data` and callback `fn(res)`.\n *\n * @param {String} url\n * @param {Mixed} data\n * @param {Function} fn\n * @return {Request}\n * @api public\n */\n\nrequest.patch = function(url, data, fn){\n  var req = request('PATCH', url);\n  if ('function' == typeof data) fn = data, data = null;\n  if (data) req.send(data);\n  if (fn) req.end(fn);\n  return req;\n};\n\n/**\n * POST `url` with optional `data` and callback `fn(res)`.\n *\n * @param {String} url\n * @param {Mixed} data\n * @param {Function} fn\n * @return {Request}\n * @api public\n */\n\nrequest.post = function(url, data, fn){\n  var req = request('POST', url);\n  if ('function' == typeof data) fn = data, data = null;\n  if (data) req.send(data);\n  if (fn) req.end(fn);\n  return req;\n};\n\n/**\n * PUT `url` with optional `data` and callback `fn(res)`.\n *\n * @param {String} url\n * @param {Mixed|Function} data or fn\n * @param {Function} fn\n * @return {Request}\n * @api public\n */\n\nrequest.put = function(url, data, fn){\n  var req = request('PUT', url);\n  if ('function' == typeof data) fn = data, data = null;\n  if (data) req.send(data);\n  if (fn) req.end(fn);\n  return req;\n};\n\n/**\n * Expose `request`.\n */\n\nmodule.exports = request;\n\n},{\"emitter\":3,\"reduce\":4}],3:[function(require,module,exports){\n\n/**\n * Expose `Emitter`.\n */\n\nmodule.exports = Emitter;\n\n/**\n * Initialize a new `Emitter`.\n *\n * @api public\n */\n\nfunction Emitter(obj) {\n  if (obj) return mixin(obj);\n};\n\n/**\n * Mixin the emitter properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(obj) {\n  for (var key in Emitter.prototype) {\n    obj[key] = Emitter.prototype[key];\n  }\n  return obj;\n}\n\n/**\n * Listen on the given `event` with `fn`.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.on =\nEmitter.prototype.addEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n  (this._callbacks[event] = this._callbacks[event] || [])\n    .push(fn);\n  return this;\n};\n\n/**\n * Adds an `event` listener that will be invoked a single\n * time then automatically removed.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.once = function(event, fn){\n  var self = this;\n  this._callbacks = this._callbacks || {};\n\n  function on() {\n    self.off(event, on);\n    fn.apply(this, arguments);\n  }\n\n  on.fn = fn;\n  this.on(event, on);\n  return this;\n};\n\n/**\n * Remove the given callback for `event` or all\n * registered callbacks.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.off =\nEmitter.prototype.removeListener =\nEmitter.prototype.removeAllListeners =\nEmitter.prototype.removeEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n\n  // all\n  if (0 == arguments.length) {\n    this._callbacks = {};\n    return this;\n  }\n\n  // specific event\n  var callbacks = this._callbacks[event];\n  if (!callbacks) return this;\n\n  // remove all handlers\n  if (1 == arguments.length) {\n    delete this._callbacks[event];\n    return this;\n  }\n\n  // remove specific handler\n  var cb;\n  for (var i = 0; i < callbacks.length; i++) {\n    cb = callbacks[i];\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1);\n      break;\n    }\n  }\n  return this;\n};\n\n/**\n * Emit `event` with the given args.\n *\n * @param {String} event\n * @param {Mixed} ...\n * @return {Emitter}\n */\n\nEmitter.prototype.emit = function(event){\n  this._callbacks = this._callbacks || {};\n  var args = [].slice.call(arguments, 1)\n    , callbacks = this._callbacks[event];\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0);\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\n      callbacks[i].apply(this, args);\n    }\n  }\n\n  return this;\n};\n\n/**\n * Return array of callbacks for `event`.\n *\n * @param {String} event\n * @return {Array}\n * @api public\n */\n\nEmitter.prototype.listeners = function(event){\n  this._callbacks = this._callbacks || {};\n  return this._callbacks[event] || [];\n};\n\n/**\n * Check if this emitter has `event` handlers.\n *\n * @param {String} event\n * @return {Boolean}\n * @api public\n */\n\nEmitter.prototype.hasListeners = function(event){\n  return !! this.listeners(event).length;\n};\n\n},{}],4:[function(require,module,exports){\n\n/**\n * Reduce `arr` with `fn`.\n *\n * @param {Array} arr\n * @param {Function} fn\n * @param {Mixed} initial\n *\n * TODO: combatible error handling?\n */\n\nmodule.exports = function(arr, fn, initial){  \n  var idx = 0;\n  var len = arr.length;\n  var curr = arguments.length == 3\n    ? initial\n    : arr[idx++];\n\n  while (idx < len) {\n    curr = fn.call(null, curr, arr[idx], ++idx, arr);\n  }\n  \n  return curr;\n};\n},{}],5:[function(require,module,exports){\n/**\n *\n *  Base64 encode / decode\n *  http://www.webtoolkit.info/\n *  https://gist.github.com/Nowalon/6579878\n **/\n\nvar Base64 = module.exports = {\n\n    // private property\n    _keyStr : \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n\n    // public method for encoding\n    encode : function (input) {\n        var output = \"\";\n        var chr1, chr2, chr3, enc1, enc2, enc3, enc4;\n        var i = 0;\n\n        input = Base64._utf8_encode(input);\n\n        while (i < input.length) {\n\n            chr1 = input.charCodeAt(i++);\n            chr2 = input.charCodeAt(i++);\n            chr3 = input.charCodeAt(i++);\n\n            enc1 = chr1 >> 2;\n            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n            enc4 = chr3 & 63;\n\n            if (isNaN(chr2)) {\n                enc3 = enc4 = 64;\n            } else if (isNaN(chr3)) {\n                enc4 = 64;\n            }\n\n            output = output +\n                this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) +\n                this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);\n\n        }\n\n        return output;\n    },\n\n    // public method for decoding\n    decode : function (input) {\n        var output = \"\";\n        var chr1, chr2, chr3;\n        var enc1, enc2, enc3, enc4;\n        var i = 0;\n\n        input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n        while (i < input.length) {\n\n            enc1 = this._keyStr.indexOf(input.charAt(i++));\n            enc2 = this._keyStr.indexOf(input.charAt(i++));\n            enc3 = this._keyStr.indexOf(input.charAt(i++));\n            enc4 = this._keyStr.indexOf(input.charAt(i++));\n\n            chr1 = (enc1 << 2) | (enc2 >> 4);\n            chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n            chr3 = ((enc3 & 3) << 6) | enc4;\n\n            output = output + String.fromCharCode(chr1);\n\n            if (enc3 != 64) {\n                output = output + String.fromCharCode(chr2);\n            }\n            if (enc4 != 64) {\n                output = output + String.fromCharCode(chr3);\n            }\n\n        }\n\n        output = Base64._utf8_decode(output);\n\n        return output;\n\n    },\n\n    // private method for UTF-8 encoding\n    _utf8_encode : function (string) {\n        string = string.replace(/\\r\\n/g,\"\\n\");\n        var utftext = \"\";\n\n        for (var n = 0; n < string.length; n++) {\n\n            var c = string.charCodeAt(n);\n\n            if (c < 128) {\n                utftext += String.fromCharCode(c);\n            }\n            else if((c > 127) && (c < 2048)) {\n                utftext += String.fromCharCode((c >> 6) | 192);\n                utftext += String.fromCharCode((c & 63) | 128);\n            }\n            else {\n                utftext += String.fromCharCode((c >> 12) | 224);\n                utftext += String.fromCharCode(((c >> 6) & 63) | 128);\n                utftext += String.fromCharCode((c & 63) | 128);\n            }\n\n        }\n\n        return utftext;\n    },\n\n    // private method for UTF-8 decoding\n    _utf8_decode : function (utftext) {\n        var string = \"\";\n        var i = 0;\n        var c = c1 = c2 = 0;\n\n        while ( i < utftext.length ) {\n\n            c = utftext.charCodeAt(i);\n\n            if (c < 128) {\n                string += String.fromCharCode(c);\n                i++;\n            }\n            else if((c > 191) && (c < 224)) {\n                c2 = utftext.charCodeAt(i+1);\n                string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\n                i += 2;\n            }\n            else {\n                c2 = utftext.charCodeAt(i+1);\n                c3 = utftext.charCodeAt(i+2);\n                string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n                i += 3;\n            }\n\n        }\n\n        return string;\n    }\n\n}\n},{}]},{},[1])(1)\n});"],"sourceRoot":"/source/"}